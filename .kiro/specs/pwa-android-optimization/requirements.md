# 需求文档

## 简介

本功能旨在优化金融工具箱网站在安卓系统上的 PWA（渐进式 Web 应用）体验。当前应用在 iOS 系统上可以正常实现添加到主屏幕后的独立 app 效果，但在安卓系统上存在问题。本需求文档定义了确保安卓设备上 PWA 功能完整性和用户体验一致性所需的所有改进。

## 术语表

- **PWA（Progressive Web App）**: 渐进式 Web 应用，使用现代 Web 技术构建的应用程序，可以像原生应用一样安装和运行
- **Manifest**: Web 应用清单文件，定义了 PWA 的元数据、图标、显示模式等配置
- **Service_Worker**: 服务工作线程，在后台运行的脚本，用于实现离线缓存和推送通知等功能
- **Standalone_Mode**: 独立模式，PWA 以全屏方式运行，隐藏浏览器 UI，类似原生应用
- **Maskable_Icon**: 可遮罩图标，适配安卓自适应图标系统的图标格式
- **Splash_Screen**: 启动画面，应用启动时显示的过渡屏幕
- **系统**: 指金融工具箱 PWA 应用

## 需求

### 需求 1: 安卓独立模式支持

**用户故事:** 作为安卓用户，我希望将应用添加到主屏幕后能以独立 app 模式运行，这样我可以获得类似原生应用的体验。

#### 验收标准

1. 当安卓用户将应用添加到主屏幕后，系统应当以独立模式（standalone）启动，不显示浏览器地址栏和导航栏
2. 当应用在独立模式下运行时，系统应当使用配置的主题色作为状态栏颜色
3. 当用户点击主屏幕图标时，系统应当直接启动应用而不是在浏览器标签页中打开
4. 当应用运行时，系统应当在安卓任务切换器中显示为独立应用而非浏览器标签页

### 需求 2: Manifest 配置优化

**用户故事:** 作为开发者，我希望 manifest 配置符合安卓系统的最佳实践，这样安卓设备可以正确识别和安装 PWA。

#### 验收标准

1. 系统应当在 manifest 中包含 `orientation` 字段，指定应用的屏幕方向偏好
2. 系统应当在 manifest 中包含 `categories` 字段，帮助应用商店分类
3. 系统应当在 manifest 中包含 `lang` 字段，指定应用的主要语言
4. 系统应当在 manifest 中包含 `dir` 字段，指定文本方向
5. 系统应当确保 `start_url` 包含查询参数以追踪 PWA 安装来源

### 需求 3: 图标适配优化

**用户故事:** 作为安卓用户，我希望应用图标在我的设备上显示正确且美观，这样我可以轻松识别和访问应用。

#### 验收标准

1. 系统应当提供 maskable 类型的图标，适配安卓自适应图标系统
2. 系统应当提供多种尺寸的图标（至少包括 192x192、512x512）
3. 当安卓系统应用不同的图标形状时（圆形、方形、圆角矩形），系统应当确保图标内容不被裁切
4. 系统应当为 maskable 图标提供足够的安全区域（safe zone），确保重要内容在任何形状下都可见
5. 系统应当同时提供 `any` 和 `maskable` 两种 purpose 的图标

### 需求 4: HTML Meta 标签配置

**用户故事:** 作为开发者，我希望添加必要的 meta 标签，这样安卓浏览器可以正确识别和处理 PWA 安装提示。

#### 验收标准

1. 系统应当在 HTML 中包含 `theme-color` meta 标签，与 manifest 中的主题色保持一致
2. 系统应当在 HTML 中包含 `mobile-web-app-capable` meta 标签，启用 PWA 功能
3. 系统应当在 HTML 中包含 `apple-mobile-web-app-capable` meta 标签，确保跨平台兼容性
4. 系统应当在 HTML 中包含 `apple-mobile-web-app-status-bar-style` meta 标签，优化状态栏显示
5. 系统应当在 HTML 中包含 manifest 文件的链接

### 需求 5: 启动画面支持

**用户故事:** 作为安卓用户，我希望应用启动时显示品牌启动画面，这样我可以获得更专业的应用体验。

#### 验收标准

1. 当用户在安卓设备上启动 PWA 时，系统应当显示自定义启动画面
2. 系统应当根据 manifest 中的 `background_color` 和图标自动生成启动画面
3. 当启动画面显示时，系统应当使用配置的背景色和应用图标
4. 系统应当确保启动画面在应用完全加载前保持显示
5. 系统应当在启动画面中居中显示应用图标

### 需求 6: 离线功能验证

**用户故事:** 作为安卓用户，我希望应用在离线状态下仍能正常工作，这样我可以在没有网络连接时继续使用核心功能。

#### 验收标准

1. 当用户在安卓设备上首次访问应用时，系统应当注册 Service Worker
2. 当 Service Worker 注册成功后，系统应当缓存核心应用资源（HTML、CSS、JS、图标）
3. 当用户在离线状态下打开应用时，系统应当从缓存加载资源并正常显示界面
4. 当用户在离线状态下使用应用时，系统应当允许访问已缓存的计算工具功能
5. 当网络恢复时，系统应当自动更新缓存的资源到最新版本

### 需求 7: 安装提示优化

**用户故事:** 作为安卓用户，我希望在合适的时机收到安装提示，这样我可以方便地将应用添加到主屏幕。

#### 验收标准

1. 当安卓用户满足 PWA 安装条件时，系统应当触发浏览器的原生安装提示
2. 系统应当确保 manifest 配置满足安卓 Chrome 的 PWA 安装标准
3. 当用户访问应用超过一定时间或频率时，系统应当显示自定义安装引导
4. 系统应当在安装提示中清晰说明安装后的好处（离线访问、快速启动等）
5. 当用户已安装应用时，系统应当不再显示安装提示

### 需求 8: 跨浏览器兼容性

**用户故事:** 作为开发者，我希望 PWA 在不同安卓浏览器上都能正常工作，这样可以覆盖更广泛的用户群体。

#### 验收标准

1. 系统应当在 Chrome for Android 上正确支持 PWA 安装和独立模式
2. 系统应当在 Samsung Internet 上正确支持 PWA 安装和独立模式
3. 系统应当在 Firefox for Android 上提供基本的 PWA 功能支持
4. 系统应当在 Edge for Android 上正确支持 PWA 安装和独立模式
5. 当浏览器不支持某些 PWA 特性时，系统应当优雅降级，确保基本功能可用
