# 实现计划：金融工具箱

## 概述

本实现计划将金融工具箱网站分解为增量式的开发任务。采用React + TypeScript + Vite技术栈，使用Ant Design作为UI组件库，ECharts作为图表库。所有计算在客户端完成，确保用户数据隐私。

## 任务列表

- [x] 1. 项目初始化与基础架构
  - 使用Vite创建React + TypeScript项目
  - 安装依赖：antd, echarts, decimal.js, react-router-dom
  - 配置Tailwind CSS和CSS Modules
  - 创建基础目录结构（components, pages, utils, constants）
  - 配置ESLint和Prettier
  - _需求: 1.3, 5.1_

- [x] 2. 通用组件开发
  - [x] 2.1 创建Layout布局组件
    - 实现页头（包含网站标题和导航菜单）
    - 实现页脚（包含免责声明和使用条款链接）
    - 确保所有页面使用一致的布局
    - _需求: 1.3, 7.9_

  - [x] 2.2 创建RiskDisclaimer风险提示组件
    - 实现首次访问弹窗（使用localStorage记录是否已显示）
    - 实现页面底部免责声明区域
    - 包含必需的风险提示文字："投资有风险，决策需谨慎"
    - _需求: 7.1, 7.2, 7.3, 7.4_

  - [x] 2.3 创建NumberInput数字输入组件
    - 支持千位分隔符显示
    - 支持范围验证
    - 显示清晰的标签和错误提示
    - _需求: 6.2, 6.5_

  - [ ]* 2.4 编写通用组件的单元测试
    - 测试Layout组件渲染
    - 测试RiskDisclaimer显示逻辑
    - 测试NumberInput验证和格式化

- [ ] 3. 工具函数库开发
  - [x] 3.1 实现计算函数（utils/calculations.js）
    - 实现calculateSimpleInterest函数
    - 实现calculateCompoundInterest函数
    - 实现calculateIRR函数（牛顿-拉弗森法）
    - 实现calculateNPV辅助函数
    - 使用decimal.js确保精度
    - _需求: 2.4, 2.5, 3.3, 5.4_

  - [x] 3.2 编写属性测试：复利大于单利

    - **属性 2: 复利大于单利（相同利率）**
    - **验证需求: 2.4, 2.5**

  - [ ]* 3.3 编写属性测试：IRR计算正确性
    - **属性 6: IRR计算正确性（NPV验证）**
    - **验证需求: 3.3**

  - [ ]* 3.4 编写属性测试：复利计算精度
    - **属性 3: 复利计算精度**
    - **验证需求: 5.4**

  - [x] 3.5 实现验证函数（utils/validators.js）
    - 实现validatePrincipal函数
    - 实现validateRate函数
    - 实现validateYears函数
    - 实现validateCashFlows函数
    - _需求: 2.1, 2.2, 2.3, 2.7_

  - [x] 3.6 编写属性测试：输入验证

    - **属性 1: 复利计算器输入验证**
    - **验证需求: 2.1, 2.2, 2.3, 2.7**

  - [x] 3.7 实现格式化函数（utils/formatters.js）
    - 实现formatNumber函数（千位分隔符）
    - 实现formatPercentage函数
    - 实现generateComparisonText函数
    - 实现interpretIRR函数
    - _需求: 2.6, 3.5, 6.5_

  - [ ]* 3.8 编写属性测试：格式化函数
    - **属性 5: 差额对比文本生成**
    - **属性 8: IRR结果格式化**
    - **属性 13: 数字格式化一致性**
    - **验证需求: 2.6, 3.4, 3.5, 6.5**

- [ ] 4. 首页开发
  - [x] 4.1 创建Home页面组件
    - 显示网站标题和简介
    - 创建三个工具卡片（复利计算器、IRR计算器、资产体检）
    - 实现卡片点击导航功能
    - 使用响应式布局
    - _需求: 1.1, 1.2, 1.4_

  - [ ]* 4.2 编写首页单元测试
    - 测试工具卡片渲染
    - 测试导航功能
    - **属性 16: 导航功能一致性**
    - **验证需求: 1.2, 1.3**

- [x] 5. 复利计算器开发
  - [x] 5.1 创建CompoundCalculator页面组件
    - 实现输入表单（本金、单利利率、复利利率、投资年限）
    - 使用NumberInput组件
    - 实现实时验证和错误提示
    - _需求: 2.1, 2.2, 2.3, 2.7_

  - [x] 5.2 实现计算逻辑和结果展示
    - 调用计算函数生成数据
    - 显示最终金额和差额
    - 显示对比文本
    - 添加工具特定的风险提示："实际收益可能因市场波动而有所不同"
    - _需求: 2.5, 2.6, 7.6_

  - [x] 5.3 集成ECharts图表
    - 创建折线图配置
    - 显示单利和复利两条曲线
    - 添加平滑动画效果
    - 确保图表响应式
    - _需求: 2.4, 6.3_

  - [ ]* 5.4 编写属性测试：图表数据完整性
    - **属性 4: 图表数据完整性**
    - **验证需求: 2.4**

  - [ ]* 5.5 编写单元测试
    - 测试特定示例（如100万本金，3%利率，10年）
    - 测试边缘情况（最小本金、最大年限）
    - 测试错误处理

- [x] 6. 检查点 - 复利计算器验证
  - 确保所有测试通过
  - 手动测试复利计算器功能
  - 如有问题请向用户反馈

- [ ] 7. IRR计算器开发
  - [x] 7.1 创建IRRCalculator页面组件
    - 实现现金流输入表格
    - 支持添加/删除现金流条目
    - 支持正负值输入
    - 实现重置按钮
    - _需求: 3.1, 3.2, 3.7_

  - [ ]* 7.2 编写属性测试：IRR输入灵活性
    - **属性 7: IRR输入灵活性**
    - **验证需求: 3.1, 3.2**

  - [x] 7.3 实现IRR计算和结果展示
    - 调用calculateIRR函数
    - 显示IRR百分比（保留2位小数）
    - 显示结果解读文本
    - 处理无解情况并显示错误消息
    - 添加工具特定的风险提示："历史收益不代表未来表现"
    - _需求: 3.3, 3.4, 3.5, 3.6, 7.7_

  - [ ]* 7.4 编写单元测试
    - 测试特定现金流示例
    - 测试边缘情况（零现金流、单个条目、全正/全负）
    - 测试错误处理

- [ ] 8. 资产体检模块开发
  - [x] 8.1 定义问卷配置（constants/assessment.js）
    - 定义ASSESSMENT_QUESTIONS常量
    - 包含7个问题：房产、贷款、老人、子女、保险、应急资金、收入
    - 为每个选项配置分数和权重
    - _需求: 4.2_

  - [x] 8.2 创建AssetAssessment页面组件
    - 实现问卷表单（使用Ant Design的Radio/Select组件）
    - 实现表单验证（必填项检查）
    - 显示清晰的问题标签
    - _需求: 4.1, 4.8_

  - [ ]* 8.3 编写属性测试：表单验证
    - **属性 12: 表单验证完整性**
    - **验证需求: 4.8**

  - [x] 8.4 实现评分算法
    - 实现calculateAssessment函数
    - 计算加权总分并归一化到0-100
    - 确定风险等级（低/中/高）
    - _需求: 4.3, 4.5_

  - [x]* 8.5 编写属性测试：评分计算
    - **属性 9: 资产评分范围约束**
    - **属性 10: 风险等级映射一致性**
    - **验证需求: 4.3, 4.5**

  - [x] 8.6 实现建议生成逻辑
    - 实现generateSuggestions函数
    - 基于答案和风险等级生成建议
    - 确保建议是产品类型而非品牌
    - _需求: 4.6, 4.7_

  - [x]* 8.7 编写属性测试：建议生成
    - **属性 11: 评估建议非空性**
    - **验证需求: 4.6, 4.7**

  - [x] 8.8 实现结果展示
    - 显示风险评分（使用ECharts仪表盘图）
    - 显示风险等级标签
    - 显示个性化建议列表
    - 添加工具特定的风险提示："本评估仅供参考，具体配置请咨询专业理财顾问"
    - _需求: 4.4, 4.5, 4.6, 7.8_

  - [ ]* 8.9 编写单元测试
    - 测试特定答案组合
    - 测试各种风险等级场景
    - 测试建议生成逻辑

- [x] 9. 检查点 - 所有工具验证
  - 确保所有测试通过
  - 手动测试三个工具的完整流程
  - 验证风险提示和免责声明显示正确
  - 如有问题请向用户反馈

- [ ] 10. 路由配置与集成
  - [x] 10.1 配置React Router
    - 设置路由：/ (首页), /compound (复利), /irr (IRR), /assessment (体检)
    - 确保所有页面使用Layout组件
    - 实现404页面
    - _需求: 1.2, 1.3_

  - [ ]* 10.2 编写集成测试
    - 测试路由导航
    - **属性 16: 导航功能一致性**
    - **验证需求: 1.2, 1.3**

- [ ] 11. 响应式设计优化
  - [x] 11.1 优化移动端布局
    - 调整所有页面的移动端样式
    - 确保图表在小屏幕上可读
    - 优化表单在移动端的输入体验
    - _需求: 1.4_

  - [ ]* 11.2 测试响应式布局
    - 测试不同视口尺寸
    - **属性 16: 导航功能一致性**（包含响应式）
    - **验证需求: 1.4**

- [ ] 12. 隐私与安全验证
  - [x] 12.1 验证客户端计算
    - 确认所有计算在本地完成
    - 检查没有向外部服务器发送用户数据的请求
    - _需求: 5.1, 5.2_

  - [ ]* 12.2 编写属性测试：客户端隔离
    - **属性 15: 客户端计算隔离**
    - **验证需求: 5.2**

- [ ] 13. 可访问性与国际化
  - [x] 13.1 可访问性改进
    - 确保所有输入字段有label
    - 添加ARIA标签
    - 测试键盘导航
    - 检查颜色对比度
    - _需求: 6.2_

  - [ ]* 13.2 编写属性测试：标签完整性
    - **属性 17: 输入字段标签完整性**
    - **验证需求: 6.2, 6.4**

  - [x] 13.3 中文支持验证
    - 确认所有界面文本为中文
    - 检查数字和日期格式符合中文习惯
    - _需求: 6.4_

- [ ] 14. 性能优化
  - [x] 14.1 代码分割
    - 配置路由级别的代码分割
    - 配置vendor chunk分离
    - _需求: 1.4_

  - [x] 14.2 组件优化
    - 使用React.memo优化重渲染
    - 优化图表渲染性能
    - 添加loading状态

- [ ] 15. 构建与部署准备
  - [x] 15.1 配置生产构建
    - 配置Vite生产构建选项
    - 启用代码压缩和tree-shaking
    - 配置资源哈希命名
    - _需求: 5.1_

  - [x] 15.2 创建部署文档
    - 编写README.md（项目说明、安装步骤、运行命令）
    - 创建部署指南（推荐Vercel/Netlify）
    - 添加环境变量说明（如果需要）

- [x] 16. 最终检查点
  - 运行所有测试（单元测试 + 属性测试）
  - 手动测试所有功能
  - 检查所有风险提示和免责声明
  - 验证响应式设计
  - 检查浏览器兼容性
  - 生成测试覆盖率报告
  - 向用户确认是否可以部署

## 注意事项

- 标记为 `*` 的任务是可选的测试任务，可以跳过以加快MVP开发
- 每个任务都引用了相应的需求编号，便于追溯
- 检查点任务确保增量验证，及时发现问题
- 属性测试使用fast-check库，每个测试至少运行100次迭代
- 单元测试专注于特定示例和边缘情况
- 所有计算必须在客户端完成，不向服务器发送用户数据
